<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>browser | realguess</title>
  <meta name="author" content="Chao Huang">
  
  <meta name="description" content="Just a blog about every detail encountered.">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="realguess"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="realguess" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-45698182-1', 'realguess.net');
  ga('send', 'pageview');
</script>


</head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">realguess</a></h1>
  <h2><a href="/">Don't afraid to try!</a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div></header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper">
<h2 class="archive-title tag">browser</h2>


  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2013-06-29T16:11:46.000Z"><a href="/2013/06/29/share-javascript-code-between-browser-(front-end)-and-node-(back-end)/">Jun 29, 2013</a></time>
      
      
  
    <h1 class="title"><a href="/2013/06/29/share-javascript-code-between-browser-(front-end)-and-node-(back-end)/">Share JavaScript Code between Browser (front-end) and Node (back-end)</a></h1>
  

    </header>
    <div class="entry">
      
        <p>One of the benefits coding in JavaScript is the ability to share code between<br>browser (front-end) and <a href="http://nodejs.org/">Node</a> (back-end) environments.</p>
<p>To share code between two different environment, first need to understand what<br>are specific to browser and what are specific to Node. Shared code should be<br>agnostic to both environments.</p>
<p>In browser environment, there is an obvious one: <code>window</code> object. In Node<br>environment, there are a few objects that are not globally defined in browser:<br><code>global</code>, <code>process</code>, <code>module</code>, <code>exports</code> and more, see <a href="http://nodejs.org/api/globals.html">global objects</a>. All<br>these variables work, but <code>exports</code> is preferred.</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>console.log(<span class="string">'Hi '</span> + (<span class="keyword">typeof</span> window !== <span class="string">'undefined'</span> ? <span class="string">'browser!'</span> : <span class="string">'Node!'</span>));
</pre></td></tr></table></figure>

<p>Once environment is identified, then it is just the matter of writing style,<br>either browser style or Node style.</p>
<p>For example, writing in Node style by passing the <code>exports</code> as the parameter:</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
</pre></td><td class="code"><pre>(<span class="function"><span class="keyword">function</span> <span class="params">(exports)</span> {</span>
  <span class="keyword">var</span> foo = exports.foo = {};

  <span class="comment">// Node style code goes here.</span>
}(<span class="keyword">typeof</span> exports === <span class="string">'undefined'</span> ? <span class="keyword">this</span> : exports));
</pre></td></tr></table></figure>

<p>By using browser style, here is an example from the <a href="http://underscorejs.org/docs/underscore.html">annotated source code</a> of<br><a href="http://underscorejs.org/">Underscore</a>:</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="code"><pre><span class="comment">// Export the Underscore object for Node.js, with backwards-compatibility</span>
<span class="comment">// for the old require() API. If we're in the browser, add _ as a global</span>
<span class="comment">// object via a string identifier, for Closure Compiler "advanced" mode.</span>
<span class="keyword">if</span> (<span class="keyword">typeof</span> exports !== <span class="string">'undefined'</span>) {
  <span class="keyword">if</span> (<span class="keyword">typeof</span> module !== <span class="string">'undefined'</span> && module.exports) {
    exports = module.exports = _;
  }
  exports._ = _;
} <span class="keyword">else</span> {
  root._ = _;
}
</pre></td></tr></table></figure>

<p>To make it easier without concerning the backward compatibility:</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="code"><pre>(<span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
  <span class="keyword">var</span> foo = {};

  <span class="keyword">if</span> (<span class="keyword">typeof</span> exports !== <span class="string">'undefined'</span>) {
    exports.foo = foo;
  } <span class="keyword">else</span> {
    <span class="keyword">this</span>.foo = foo;
  }

  <span class="comment">// Browser style code goes here.</span>
}).call(<span class="keyword">this</span>);
</pre></td></tr></table></figure>

<p><code>this</code> is the same as <code>window</code> object in the browser environment.</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre>(<span class="function"><span class="keyword">function</span> <span class="params">(window)</span> {</span>
  <span class="comment">// Browser style code goes here.</span>
}(<span class="keyword">this</span>));
</pre></td></tr></table></figure>

<p>One more thing, writing in <a href="coffeescript.org">CoffeeScript</a> is even better, because the compiled<br>code is already wrapped in closure, fewer indentation is needed.</p>
<figure class="highlight lang-coffeescript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
</pre></td><td class="code"><pre>foo = {}
<span class="keyword">if</span> exports <span class="keyword">isnt</span> <span class="string">'undefined'</span>
  exports.foo = foo
<span class="keyword">else</span>
  <span class="keyword">this</span>.foo = foo

<span class="comment"># Browser style code goes here.</span>
</pre></td></tr></table></figure>

<p>Compile to JavaScript by <a href="coffeescript.org">CoffeeScript</a> 1.6.3:</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="code"><pre>(<span class="keyword">function</span>() {
  <span class="keyword">var</span> foo;

  foo = {};

  <span class="keyword">if</span> (exports !== <span class="string">'undefined'</span>) {
    exports.foo = foo;
  } <span class="keyword">else</span> {
    <span class="keyword">this</span>.foo = foo;
  }

}).call(<span class="keyword">this</span>);
</pre></td></tr></table></figure>

<p>Everything will be encapsulated inside the <code>foo</code> object.</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


  

  <nav id="pagination">
  
  
  <div class="clearfix"></div>
</nav>
</div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="Search">
    <input type="hidden" name="q" value="site:realguess.net">
  </form>
</div>

  

  
<div class="widget tag">
  <h3 class="title">Tags</h3>
  <ul class="entry">
  
    <li><a href="/tags/2013/">2013</a><small>1</small></li>
  
    <li><a href="/tags/absolute-path/">absolute-path</a><small>1</small></li>
  
    <li><a href="/tags/amazon/">amazon</a><small>1</small></li>
  
    <li><a href="/tags/amtrak/">amtrak</a><small>1</small></li>
  
    <li><a href="/tags/android/">android</a><small>1</small></li>
  
    <li><a href="/tags/android-4.3/">android-4.3</a><small>1</small></li>
  
    <li><a href="/tags/anonymous-function/">anonymous-function</a><small>1</small></li>
  
    <li><a href="/tags/array/">array</a><small>2</small></li>
  
    <li><a href="/tags/automatic-link/">automatic-link</a><small>1</small></li>
  
    <li><a href="/tags/awk/">awk</a><small>1</small></li>
  
    <li><a href="/tags/aws/">aws</a><small>2</small></li>
  
    <li><a href="/tags/aws-cli/">aws-cli</a><small>1</small></li>
  
    <li><a href="/tags/best-practice/">best-practice</a><small>1</small></li>
  
    <li><a href="/tags/big-apple/">big-apple</a><small>1</small></li>
  
    <li><a href="/tags/big-easy/">big-easy</a><small>1</small></li>
  
    <li><a href="/tags/big-number/">big-number</a><small>1</small></li>
  
    <li><a href="/tags/browser/">browser</a><small>1</small></li>
  
    <li><a href="/tags/cat/">cat</a><small>1</small></li>
  
    <li><a href="/tags/chat/">chat</a><small>1</small></li>
  
    <li><a href="/tags/chrome/">chrome</a><small>1</small></li>
  
    <li><a href="/tags/cli/">cli</a><small>1</small></li>
  
    <li><a href="/tags/cloud-storage/">cloud-storage</a><small>1</small></li>
  
    <li><a href="/tags/cocoon/">cocoon</a><small>1</small></li>
  
    <li><a href="/tags/coding-style/">coding-style</a><small>1</small></li>
  
    <li><a href="/tags/coffeelint/">coffeelint</a><small>1</small></li>
  
    <li><a href="/tags/coffeescript/">coffeescript</a><small>7</small></li>
  
    <li><a href="/tags/command-history/">command-history</a><small>1</small></li>
  
    <li><a href="/tags/command-line/">command-line</a><small>1</small></li>
  
    <li><a href="/tags/command-line-interface/">command-line-interface</a><small>1</small></li>
  
    <li><a href="/tags/configuration/">configuration</a><small>1</small></li>
  
    <li><a href="/tags/crescent/">crescent</a><small>1</small></li>
  
    <li><a href="/tags/cron/">cron</a><small>2</small></li>
  
    <li><a href="/tags/crontab/">crontab</a><small>1</small></li>
  
    <li><a href="/tags/cryptography/">cryptography</a><small>1</small></li>
  
    <li><a href="/tags/custom-domain/">custom-domain</a><small>1</small></li>
  
    <li><a href="/tags/custom-generator/">custom-generator</a><small>1</small></li>
  
    <li><a href="/tags/cwd/">cwd</a><small>1</small></li>
  
    <li><a href="/tags/datagram/">datagram</a><small>1</small></li>
  
    <li><a href="/tags/date/">date</a><small>1</small></li>
  
    <li><a href="/tags/diff/">diff</a><small>1</small></li>
  
    <li><a href="/tags/distributed-team/">distributed-team</a><small>1</small></li>
  
    <li><a href="/tags/docco/">docco</a><small>1</small></li>
  
    <li><a href="/tags/echo/">echo</a><small>1</small></li>
  
    <li><a href="/tags/ecmascript-harmony/">ecmascript-harmony</a><small>1</small></li>
  
    <li><a href="/tags/encryption/">encryption</a><small>1</small></li>
  
    <li><a href="/tags/environment/">environment</a><small>2</small></li>
  
    <li><a href="/tags/environment-variable/">environment-variable</a><small>1</small></li>
  
    <li><a href="/tags/express/">express</a><small>1</small></li>
  
    <li><a href="/tags/file-system/">file-system</a><small>1</small></li>
  
    <li><a href="/tags/filename/">filename</a><small>1</small></li>
  
    <li><a href="/tags/fs/">fs</a><small>1</small></li>
  
    <li><a href="/tags/function/">function</a><small>3</small></li>
  
    <li><a href="/tags/function-declaration/">function-declaration</a><small>2</small></li>
  
    <li><a href="/tags/function-expression/">function-expression</a><small>3</small></li>
  
    <li><a href="/tags/function-innovation/">function-innovation</a><small>1</small></li>
  
    <li><a href="/tags/generator/">generator</a><small>1</small></li>
  
    <li><a href="/tags/get/">get</a><small>1</small></li>
  
    <li><a href="/tags/ghost/">ghost</a><small>1</small></li>
  
    <li><a href="/tags/github/">github</a><small>1</small></li>
  
    <li><a href="/tags/goal/">goal</a><small>1</small></li>
  
    <li><a href="/tags/google-keep/">google-keep</a><small>1</small></li>
  
    <li><a href="/tags/grunt/">grunt</a><small>1</small></li>
  
    <li><a href="/tags/grunt-contrib-jshint/">grunt-contrib-jshint</a><small>1</small></li>
  
    <li><a href="/tags/grunt-contrib-watch/">grunt-contrib-watch</a><small>1</small></li>
  
    <li><a href="/tags/guard/">guard</a><small>1</small></li>
  
    <li><a href="/tags/head/">head</a><small>2</small></li>
  
    <li><a href="/tags/hipchat/">hipchat</a><small>1</small></li>
  
    <li><a href="/tags/hong-kong/">hong-kong</a><small>1</small></li>
  
    <li><a href="/tags/hosted-zone/">hosted-zone</a><small>1</small></li>
  
    <li><a href="/tags/http/">http</a><small>1</small></li>
  
    <li><a href="/tags/id/">id</a><small>1</small></li>
  
    <li><a href="/tags/iife/">iife</a><small>2</small></li>
  
    <li><a href="/tags/immediately-invoked-function-expression/">immediately-invoked-function-expression</a><small>2</small></li>
  
    <li><a href="/tags/interpreter/">interpreter</a><small>1</small></li>
  
    <li><a href="/tags/javascript/">javascript</a><small>8</small></li>
  
    <li><a href="/tags/jelly-bean/">jelly-bean</a><small>1</small></li>
  
    <li><a href="/tags/join/">join</a><small>1</small></li>
  
    <li><a href="/tags/jshint/">jshint</a><small>1</small></li>
  
    <li><a href="/tags/json/">json</a><small>1</small></li>
  
    <li><a href="/tags/koa/">koa</a><small>1</small></li>
  
    <li><a href="/tags/line-divider/">line-divider</a><small>1</small></li>
  
    <li><a href="/tags/linux/">linux</a><small>3</small></li>
  
    <li><a href="/tags/livereload/">livereload</a><small>1</small></li>
  
    <li><a href="/tags/markdown/">markdown</a><small>2</small></li>
  
    <li><a href="/tags/mi3/">mi3</a><small>1</small></li>
  
    <li><a href="/tags/mongodb/">mongodb</a><small>1</small></li>
  
    <li><a href="/tags/mongoexport/">mongoexport</a><small>1</small></li>
  
    <li><a href="/tags/multi-parts/">multi-parts</a><small>1</small></li>
  
    <li><a href="/tags/named-function/">named-function</a><small>1</small></li>
  
    <li><a href="/tags/nb/">nb</a><small>1</small></li>
  
    <li><a href="/tags/network/">network</a><small>1</small></li>
  
    <li><a href="/tags/new-orleans/">new-orleans</a><small>1</small></li>
  
    <li><a href="/tags/new-york/">new-york</a><small>1</small></li>
  
    <li><a href="/tags/node/">node</a><small>8</small></li>
  
    <li><a href="/tags/nodemon/">nodemon</a><small>1</small></li>
  
    <li><a href="/tags/normalization/">normalization</a><small>1</small></li>
  
    <li><a href="/tags/nota-bene/">nota-bene</a><small>1</small></li>
  
    <li><a href="/tags/note-well/">note-well</a><small>1</small></li>
  
    <li><a href="/tags/npm/">npm</a><small>1</small></li>
  
    <li><a href="/tags/npm-module/">npm-module</a><small>1</small></li>
  
    <li><a href="/tags/null/">null</a><small>1</small></li>
  
    <li><a href="/tags/object/">object</a><small>1</small></li>
  
    <li><a href="/tags/parseint/">parseint</a><small>1</small></li>
  
    <li><a href="/tags/path/">path</a><small>3</small></li>
  
    <li><a href="/tags/ping/">ping</a><small>1</small></li>
  
    <li><a href="/tags/preinstall/">preinstall</a><small>1</small></li>
  
    <li><a href="/tags/process/">process</a><small>1</small></li>
  
    <li><a href="/tags/proxy/">proxy</a><small>1</small></li>
  
    <li><a href="/tags/query-parameter/">query-parameter</a><small>1</small></li>
  
    <li><a href="/tags/record-set/">record-set</a><small>1</small></li>
  
    <li><a href="/tags/relative-path/">relative-path</a><small>1</small></li>
  
    <li><a href="/tags/remote-working/">remote-working</a><small>1</small></li>
  
    <li><a href="/tags/repl/">repl</a><small>1</small></li>
  
    <li><a href="/tags/require/">require</a><small>1</small></li>
  
    <li><a href="/tags/rlwrap/">rlwrap</a><small>1</small></li>
  
    <li><a href="/tags/route-53/">route-53</a><small>1</small></li>
  
    <li><a href="/tags/scaffolding/">scaffolding</a><small>1</small></li>
  
    <li><a href="/tags/script/">script</a><small>1</small></li>
  
    <li><a href="/tags/settings/">settings</a><small>1</small></li>
  
    <li><a href="/tags/shabang/">shabang</a><small>1</small></li>
  
    <li><a href="/tags/sharing/">sharing</a><small>1</small></li>
  
    <li><a href="/tags/shebang/">shebang</a><small>1</small></li>
  
    <li><a href="/tags/shell/">shell</a><small>1</small></li>
  
    <li><a href="/tags/shell-script/">shell-script</a><small>1</small></li>
  
    <li><a href="/tags/source-maps/">source-maps</a><small>1</small></li>
  
    <li><a href="/tags/split/">split</a><small>1</small></li>
  
    <li><a href="/tags/sshuttle/">sshuttle</a><small>1</small></li>
  
    <li><a href="/tags/startup/">startup</a><small>1</small></li>
  
    <li><a href="/tags/stats/">stats</a><small>1</small></li>
  
    <li><a href="/tags/success/">success</a><small>1</small></li>
  
    <li><a href="/tags/sync/">sync</a><small>1</small></li>
  
    <li><a href="/tags/time-zone/">time-zone</a><small>1</small></li>
  
    <li><a href="/tags/todo/">todo</a><small>1</small></li>
  
    <li><a href="/tags/train/">train</a><small>1</small></li>
  
    <li><a href="/tags/travel/">travel</a><small>1</small></li>
  
    <li><a href="/tags/tumblr/">tumblr</a><small>1</small></li>
  
    <li><a href="/tags/twitter/">twitter</a><small>1</small></li>
  
    <li><a href="/tags/ubuntu/">ubuntu</a><small>1</small></li>
  
    <li><a href="/tags/uglifyjs/">uglifyjs</a><small>1</small></li>
  
    <li><a href="/tags/underscore/">underscore</a><small>1</small></li>
  
    <li><a href="/tags/unix/">unix</a><small>1</small></li>
  
    <li><a href="/tags/username/">username</a><small>1</small></li>
  
    <li><a href="/tags/vim/">vim</a><small>2</small></li>
  
    <li><a href="/tags/vimdiff/">vimdiff</a><small>1</small></li>
  
    <li><a href="/tags/vpn/">vpn</a><small>1</small></li>
  
    <li><a href="/tags/web-framework/">web-framework</a><small>1</small></li>
  
    <li><a href="/tags/xiaomi/">xiaomi</a><small>1</small></li>
  
    <li><a href="/tags/yeoman/">yeoman</a><small>1</small></li>
  
    <li><a href="/tags/yield/">yield</a><small>1</small></li>
  
    <li><a href="/tags/小米/">小米</a><small>1</small></li>
  
    <li><a href="/tags/小米手机/">小米手机</a><small>1</small></li>
  
  </ul>
</div>


  

</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2014 Chao Huang
  
</div>
<div class="clearfix"></div></footer>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

</body>
</html>