<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>javascript | realguess</title>
  <meta name="author" content="Chao Huang">
  
  <meta name="description" content="Just a blog about every detail encountered.">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="realguess"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="realguess" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-45698182-1', 'realguess.net');
  ga('send', 'pageview');
</script>


</head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">realguess</a></h1>
  <h2><a href="/">Don't afraid to try!</a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div></header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper">
<h2 class="archive-title tag">javascript</h2>


  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2014-03-02T17:55:23.000Z"><a href="/2014/03/02/immediately-invoked-function-expression/">Mar 2, 2014</a></time>
      
      
  
    <h1 class="title"><a href="/2014/03/02/immediately-invoked-function-expression/">Immediately Invoked Function Expression</a></h1>
  

    </header>
    <div class="entry">
      
        <p>What&#39;s difference between:</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
</pre></td><td class="code"><pre>(<span class="keyword">function</span>(){}());
(<span class="keyword">function</span>(){})();
</pre></td></tr></table></figure>

<p>This is function declaration:</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre><span class="function"><span class="keyword">function</span> <span class="title">foo</span><span class="params">()</span>{</span>}
</pre></td></tr></table></figure>

<p>The identifier of the function declaration is required.</p>
<p>This is function expression:</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre><span class="keyword">var</span> foo = <span class="keyword">function</span>(){};
</pre></td></tr></table></figure>

<p>The right hand side of the assignment must be an expression. And function identifier is optional. Check the previous article about the difference between <a href="/2014/03/01/function-declaration-and-function-expression/">function declaration and function expression</a>.</p>
<p>Now, come in the grouping operator, which return the result of evaluating an expression:</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>(<span class="keyword">function</span>(){});
</pre></td></tr></table></figure>

<p>If we do it with named function:</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
</pre></td><td class="code"><pre><span class="function"><span class="keyword">function</span> <span class="title">foo</span><span class="params">()</span>{</span>}
(foo);
</pre></td></tr></table></figure>

<p>or</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>(<span class="function"><span class="keyword">function</span> <span class="title">foo</span><span class="params">()</span>{</span>});
</pre></td></tr></table></figure>

<p>But we haven‘t done anything here, in another word, we haven’t invoked the function. We merely evaluate the function in three occasions. Function is object in JavaScript, when you&#39;re evaluating an object, the result is still an object:</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
</pre></td><td class="code"><pre>console.log(<span class="function"><span class="keyword">function</span> <span class="title">foo</span><span class="params">()</span>{</span>}); <span class="comment">// [Function: foo]</span>
console.log(<span class="function"><span class="keyword">function</span> <span class="params">()</span>{</span>});    <span class="comment">// [Function]</span>
<span class="function"><span class="keyword">function</span> <span class="title">bar</span><span class="params">()</span>{</span>}
console.log(bar);              <span class="comment">// [Function: bar]</span>
console.log({});               <span class="comment">// {}</span>
</pre></td></tr></table></figure>

<p>Now, let&#39;s apply function invocation, and do it the traditional way:</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>foo();
</pre></td></tr></table></figure>

<p>The function has been invoked, and it will return the result of the function.</p>
<p>Replace the identifier with function declaration:</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre><span class="function"><span class="keyword">function</span> <span class="title">foo</span><span class="params">()</span>{</span>}();
</pre></td></tr></table></figure>

<p>However, this does not work. Because interpreter treats it as a function declaration, and <code>(</code> will become an unexpected token. Function declaration cannot be invoked immediately. So, we need to make it an expression, by using the grouping operator:</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>(<span class="function"><span class="keyword">function</span> <span class="title">foo</span><span class="params">()</span>{</span>})();
</pre></td></tr></table></figure>

<p>The function identifier is no longer necessary:</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>(<span class="keyword">function</span>(){})();
</pre></td></tr></table></figure>

<p>Since grouping operator return the result of the expression, we can just drop it:</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre><span class="keyword">function</span>(){}();
</pre></td></tr></table></figure>

<p>But this statement becomes a function declaration again, so we need to place the grouping operator around it:</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>(<span class="keyword">function</span>(){}());
</pre></td></tr></table></figure>

<p>Okay, but what&#39;s difference between:</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
</pre></td><td class="code"><pre>(<span class="keyword">function</span>(){}());
(<span class="keyword">function</span>(){})();
</pre></td></tr></table></figure>

<p>There is no difference, they are both function expressions being invoked immediately.  Function invocation can only be done via function expression. But first one is more align with <code>foo()</code>, the traditional way. According to the <a href="http://javascript.crockford.com/code.html">Code Convention for JavaScript Programming Language</a> by Douglas Crockford:</p>
<blockquote>
<p>When a function is to be invoked immediately, the entire <em>invocation expression</em> should be wrapped in parens so that it is clear that the value being produced is the result of the function and not the function itself.</p>
</blockquote>
<p>The invocation expression is <code>function(){}()</code>, and wrap it around parenthesis becomes <code>(function(){}());</code>.</p>
<p>Therefore, this first method is more traditional and preferred.</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2014-03-01T08:04:36.000Z"><a href="/2014/03/01/function-declaration-and-function-expression/">Mar 1, 2014</a></time>
      
      
  
    <h1 class="title"><a href="/2014/03/01/function-declaration-and-function-expression/">Function Declaration and Function Expression</a></h1>
  

    </header>
    <div class="entry">
      
        <p>In JavaScript, what is <em>function declaration</em>?</p>
<pre><code><span class="function"><span class="keyword">function</span> <span class="title">square</span><span class="params">(n)</span> { <span class="title">return</span> <span class="title">n</span> * <span class="title">n</span>; }</span></code></pre>
<p>Here we declare a function and name it “square”. But what is <em>function expression</em>?</p>
<pre><code>var square = <span class="function"><span class="keyword">function</span> <span class="params">(n)</span> { <span class="title">return</span> <span class="title">n</span> * <span class="title">n</span>; };</span></code></pre>
<p>When you start a statement with keyword <code>function</code>, then the statement is <em>function declaration</em>, everything else is <em>function expression</em>.</p>
<p>Function expression can either be named or anonymous. The above is anonymous function, and here is a named one:</p>
<pre><code>var square = <span class="function"><span class="keyword">function</span> <span class="title">square</span><span class="params">(n)</span> { <span class="title">return</span> <span class="title">n</span> * <span class="title">n</span>; };</span></code></pre>
<p>There is a variable <code>square</code> and function name <code>square</code>, but they are not the same. The scopes are different. The function name <code>square</code> of the function expression can be only used inside the function, mainly for debugging purpose. Accessing from outside the function, will throw <code>ReferenceError</code>:</p>
<pre><code><span class="keyword">var</span> foo = <span class="function"><span class="keyword">function</span> <span class="title">bar</span><span class="params">()</span> {</span>};
bar(); <span class="comment">// ReferenceError: bar is not defined</span></code></pre>
<p>We can also use property ‘name’ to differentiate a named vs. an anonymous function:</p>
<pre><code>console.<span class="command">log</span>(square.<span class="property">name</span>); // empty <span class="type">string</span> <span class="keyword">for</span> an anonymous function</code></pre>
<p>However, you cannot create an anonymous function declaration, for a very obvious reason:</p>
<pre><code><span class="function"><span class="keyword">function</span> <span class="params">(n)</span> { <span class="title">return</span> <span class="title">n</span> * <span class="title">n</span>; } // <span class="title">SyntaxError</span>: <span class="title">Unexpected</span> <span class="title">token</span> <span class="params">(</code></pre>
<p>Another difference between function declaration and function expression is hoisting:</p>
<pre><code>square(<span class="number">10</span>); <span class="comment">// 100</span>
<span class="function"><span class="keyword">function</span> <span class="title">square</span><span class="params">(n)</span> {</span> <span class="keyword">return</span> n * n; }</code></pre>
<p>Function defined by declaration is hoisted, but not for function expression:</p>
<pre><code>square(<span class="number">10</span>); // TypeError: undefined is <span class="keyword">not</span> a <span class="function"><span class="keyword">function</span>
<span class="title">var</span> <span class="title">square</span> = <span class="title">function</span> <span class="params">(n)</span></span> { <span class="keyword">return</span> n * n; }</code></pre>
<p>The variable declaration is hoisted, but not for the definition. Therefore, result in <code>TypeError</code>. However, for best practice, functions should be defined before being used.</p>
<p>In conclusion:</p>
<ul>
<li>Function declaration must start with keyword <code>function</code> in the beginning of the statement. Everything else is function expression.</li>
<li>Function expression can be anonymous and named, but function declaration can only be named.</li>
<li>Function declaration is hoisted, but not function expression.</li>
</ul>
<p>This function declaration happens inside a unreachable block.</p>
<pre><code>square(<span class="number">10</span>); <span class="comment">// 100</span>
<span class="keyword">if</span> (<span class="literal">false</span>) {
  <span class="function"><span class="keyword">function</span> <span class="title">square</span><span class="params">(n)</span> {</span> <span class="keyword">return</span> n * n; }
}</code></pre>
<p>There is no block scope in JavaScript. Spaces in the beginning of keyword <code>function</code> do not count. This is still a valid function declaration.</p>
<p>A simple way to turn function declaration into function expression is by wrapping around parentheses:</p>
<pre><code><span class="list">(<span class="title">function</span><span class="body"> square<span class="list">(<span class="title">n</span><span class="body">)</span></span> { return n <span class="variable">* n; });</code></pre>
<p>We are applying the grouping operator <code>()</code> here, which evaluates the function expression.</p>
<p>Another way:</p>
<pre><code><span class="function"><span class="title">foo</span><span class="params">(err, <span class="keyword">fun</span><span class="function_name">ction</span>()<span class="tuple">{}</span>);</code></pre>
<p>Just think about <code>,</code> as <code>()</code>.</p>
<p>Other good reads:</p>
<ul>
<li>StackOverflow, <a href="http://stackoverflow.com/q/336859/594696">var functionName = function() {} vs function functionName() {}</a></li>
<li>Angus Croll, <a href="http://javascriptweblog.wordpress.com/2010/07/06/function-declarations-vs-function-expressions/">Function Declarations vs. Function Expressions</a></li>
<li>MDN, <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions_and_function_scope#Function_constructor_vs._function_declaration_vs._function_expression">Function constructor vs. function declaration vs. function expression</a></li>
</ul>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2014-01-25T05:19:23.000Z"><a href="/2014/01/24/null/">Jan 24, 2014</a></time>
      
      
  
    <h1 class="title"><a href="/2014/01/24/null/">null</a></h1>
  

    </header>
    <div class="entry">
      
        <p>In JavaScript, you assign value <code>null</code> to an object property to indicate that the property is defined but with no value. But using <code>null</code> outside the JavaScript domain becomes tricky. For example, in URL query parameters:</p>
<pre><code>?foo=<span class="keyword">null</span>&amp;bar=bar</code></pre>
<p>after parsing the query:</p>
<pre><code>{
  "<span class="attribute">foo</span>": <span class="value"><span class="string">"null"</span></span>,
  "<span class="attribute">bar</span>": <span class="value"><span class="string">"bar"</span>
}</span></code></pre>
<p>Should the value of <code>foo</code> be parsed from <code>&quot;null&quot;</code> string into <code>null</code> object? Unless you know the context.</p>
<p>Using <code>null</code> in both schema design and URL query gave me a few headaches. So, I have decided to use string and throw away <code>null</code>.  As string is the most basic data type across many applications. For simplier design and greater compatibility and portability, use empty string instead of <code>null</code>.</p>
<p>Therefore, the value of query parameter <code>foo</code> should be:</p>
<pre><code>?foo=<span class="keyword">null</span>&amp;bar=bar <span class="comment">// "null"</span>
?foo=&amp;bar=bar     <span class="comment">// ""</span></code></pre>
<p>and:</p>
<pre><code><span class="string">"null"</span> <span class="exclamation_mark">!</span>== <span class="string">""</span></code></pre>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2014-01-09T17:18:19.000Z"><a href="/2014/01/09/working-with-big-number-in-javascript/">Jan 9, 2014</a></time>
      
      
  
    <h1 class="title"><a href="/2014/01/09/working-with-big-number-in-javascript/">Working with Big Number in JavaScript</a></h1>
  

    </header>
    <div class="entry">
      
        <p>JavaScript is only capable of handling 53-bit numbers, if you are working with a big number such as <a href="https://dev.twitter.com/docs/twitter-ids-json-and-snowflake">Twitter ID</a>, which is using 64-bit number, then you need to find an external library to do that, otherwise, there will be precision lost:</p>
<pre><code><span class="blockquote">&gt; num = 420938523475451904</span>
420938523475451900
<span class="blockquote">&gt; num = 420938523475451904 + 1</span>
420938523475451900
<span class="blockquote">&gt; num = 420938523475451904 - 1</span>
420938523475451900</code></pre>
<p>Here is one library to use in Node environment, install <a href="https://github.com/MikeMcl/big.js/">Big.js</a>:</p>
<pre><code><span class="variable">$ </span>npm install big.js</code></pre>
<p>Load the module:</p>
<pre><code>&gt; BigNum = require(<span class="comment">'big.js')</span>
{ [<span class="keyword">Function</span>: Big] DP: <span class="number">20</span>, RM: <span class="number">1</span> }</code></pre>
<p>Use string to create the big number:</p>
<pre><code>&gt; num = <span class="class">BigNum</span>(<span class="string">'420938523475451904'</span>)
{ <span class="method">s:</span> <span class="number">1</span>,
  <span class="method">e:</span> <span class="number">17</span>,
  <span class="method">c:</span> [ <span class="number">4</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">9</span>, <span class="number">3</span>, <span class="number">8</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">9</span>, <span class="number">0</span>, <span class="number">4</span> ] }
&gt; num.toString()
<span class="string">'420938523475451904'</span></code></pre>
<p>Perform addition:</p>
<pre><code><span class="blockquote">&gt; num.plus(1).toString()</span>
'420938523475451905'</code></pre>
<p>Perform substraction:</p>
<pre><code><span class="blockquote">&gt; num.minus(1).toString()</span>
'420938523475451903'</code></pre>
<p>There are other packages that yet to be tested:</p>
<ul>
<li><a href="https://github.com/MikeMcl/bignumber.js/">bignumber.js</a></li>
<li><a href="https://github.com/rauschma/strint">strint.js</a></li>
<li><a href="http://jsfromhell.com/classes/bignumber">bignumber</a></li>
<li><a href="https://github.com/jtobey/javascript-bignum">JavaScript bignumber</a></li>
</ul>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2013-11-29T20:00:30.000Z"><a href="/2013/11/29/written-in-coffeescript,-required-in-javascript/">Nov 29, 2013</a></time>
      
      
  
    <h1 class="title"><a href="/2013/11/29/written-in-coffeescript,-required-in-javascript/">Written in CoffeeScript, Required in JavaScript</a></h1>
  

    </header>
    <div class="entry">
      
        <p>If you are writing in CoffeeScript, then requiring another module written in CoffeeScript works the same as as both scripts are in JavaScript:</p>
<figure class="highlight lang-coffeescript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>cm = require <span class="string">'coffee-module'</span>
</pre></td></tr></table></figure>

<p>But if you are writing in JavaScript, and the dependent module is in CoffeeScript, you have to include CoffeeScript as a dependency with require statement:</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
</pre></td><td class="code"><pre>require(<span class="string">'coffee-script'</span>);
<span class="keyword">var</span> cm = require(<span class="string">'coffee-module'</span>);
</pre></td></tr></table></figure>

<p>For better compatibility, source codes written in CoffeeScript should be compiled into JavaScript. But what is the best practice? You don&#39;t want to maintain two languages. When to compile? Here is two options:</p>
<ol>
<li>Compile before publish the module</li>
<li>Compile after module install</li>
</ol>
<p>The advantage of the first approach is that there is no dependency on CoffeeScript. The module has been compiled into JavaScript prior to submitting to module registry. However, this approach requires two repositories, one is source code repository, and another one is the published module repository. If you are working on a private project, it is less likely that you will publish your module to an public NPM registry or running your own private one. It is more likely to have a single source code repository. Therefore, the second approach might be better in this situation. However, <code>coffee-script</code> must be added in <code>dependency</code>, or it must be installed globally with <code>coffee</code> command available during <code>preinstall</code> phase. Although this approach is not recommended in <a href="https://npmjs.org/doc/misc/npm-scripts.html">npm-scripts</a>, before setting up a private NPM registry, this is the way to go.</p>
<p>Here is the required fields in <code>package.json</code>:</p>
<figure class="highlight lang-json"><table><tr><td class="gutter"><pre>1
2
3
4
5
</pre></td><td class="code"><pre>{
  "<span class="attribute">scripts</span>": <span class="value">{
    "<span class="attribute">preinstall</span>": <span class="value"><span class="string">"coffee --compile --bare --output lib/ src/"</span>
  }</span>
}</span>
</pre></td></tr></table></figure>


      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2013-10-03T05:23:58.000Z"><a href="/2013/10/02/javascript-parseint(array)-only-converts-the-first-element/">Oct 2, 2013</a></time>
      
      
  
    <h1 class="title"><a href="/2013/10/02/javascript-parseint(array)-only-converts-the-first-element/">JavaScript parseInt(array) Only Converts the First Element</a></h1>
  

    </header>
    <div class="entry">
      
        <p>Converting from one type to another frequently causes bugs or unexpected result if you&#39;re not careful. For example, when converting a string to an integer, we use the following function:</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre><span class="keyword">var</span> num = parseInt(string, radix);
</pre></td></tr></table></figure>

<p>Accidentally, I used an array of numeric strings in place of string for conversion.</p>
<p>As stated in <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/parseInt">MDN parseInt</a>:</p>
<blockquote>
<p>If string is not a string, then it is converted to one. Leading whitespace in the string is ignored.</p>
</blockquote>
<p>The array is converted to string.</p>
<p>If the array has only one element, then there won&#39;t be any problem:</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
</pre></td><td class="code"><pre>[<span class="number">10</span>].toString()
&gt; <span class="string">'10'</span>
parseInt(<span class="string">'10'</span>, <span class="number">10</span>)
&gt; <span class="number">10</span>
</pre></td></tr></table></figure>

<p>But when there are more than one element, only the first element will be parsed:</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
</pre></td><td class="code"><pre>[<span class="number">10</span>, <span class="number">5</span>].toString()
&gt; <span class="string">'10,5'</span>
parseInt(<span class="string">'10,5'</span>, <span class="number">10</span>)
&gt; <span class="number">10</span>
</pre></td></tr></table></figure>

<p>Therefore, you have to be very careful when processing query parameter like:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>?<span class="built_in">year</span>=<span class="number">2013</span>&<span class="built_in">year</span>=<span class="number">2012</span>
</pre></td></tr></table></figure>

<p>In many cases, it will be converted to:</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>year: [<span class="string">'2013'</span>, <span class="string">'2012'</span>]
</pre></td></tr></table></figure>

<p>After running through <code>parseInt</code>, it will result in <code>2013</code>, might not be what you are looking for.</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2013-06-29T16:11:46.000Z"><a href="/2013/06/29/share-javascript-code-between-browser-(front-end)-and-node-(back-end)/">Jun 29, 2013</a></time>
      
      
  
    <h1 class="title"><a href="/2013/06/29/share-javascript-code-between-browser-(front-end)-and-node-(back-end)/">Share JavaScript Code between Browser (front-end) and Node (back-end)</a></h1>
  

    </header>
    <div class="entry">
      
        <p>One of the benefits coding in JavaScript is the ability to share code between<br>browser (front-end) and <a href="http://nodejs.org/">Node</a> (back-end) environments.</p>
<p>To share code between two different environment, first need to understand what<br>are specific to browser and what are specific to Node. Shared code should be<br>agnostic to both environments.</p>
<p>In browser environment, there is an obvious one: <code>window</code> object. In Node<br>environment, there are a few objects that are not globally defined in browser:<br><code>global</code>, <code>process</code>, <code>module</code>, <code>exports</code> and more, see <a href="http://nodejs.org/api/globals.html">global objects</a>. All<br>these variables work, but <code>exports</code> is preferred.</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>console.log(<span class="string">'Hi '</span> + (<span class="keyword">typeof</span> window !== <span class="string">'undefined'</span> ? <span class="string">'browser!'</span> : <span class="string">'Node!'</span>));
</pre></td></tr></table></figure>

<p>Once environment is identified, then it is just the matter of writing style,<br>either browser style or Node style.</p>
<p>For example, writing in Node style by passing the <code>exports</code> as the parameter:</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
</pre></td><td class="code"><pre>(<span class="function"><span class="keyword">function</span> <span class="params">(exports)</span> {</span>
  <span class="keyword">var</span> foo = exports.foo = {};

  <span class="comment">// Node style code goes here.</span>
}(<span class="keyword">typeof</span> exports === <span class="string">'undefined'</span> ? <span class="keyword">this</span> : exports));
</pre></td></tr></table></figure>

<p>By using browser style, here is an example from the <a href="http://underscorejs.org/docs/underscore.html">annotated source code</a> of<br><a href="http://underscorejs.org/">Underscore</a>:</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="code"><pre><span class="comment">// Export the Underscore object for Node.js, with backwards-compatibility</span>
<span class="comment">// for the old require() API. If we're in the browser, add _ as a global</span>
<span class="comment">// object via a string identifier, for Closure Compiler "advanced" mode.</span>
<span class="keyword">if</span> (<span class="keyword">typeof</span> exports !== <span class="string">'undefined'</span>) {
  <span class="keyword">if</span> (<span class="keyword">typeof</span> module !== <span class="string">'undefined'</span> && module.exports) {
    exports = module.exports = _;
  }
  exports._ = _;
} <span class="keyword">else</span> {
  root._ = _;
}
</pre></td></tr></table></figure>

<p>To make it easier without concerning the backward compatibility:</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="code"><pre>(<span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
  <span class="keyword">var</span> foo = {};

  <span class="keyword">if</span> (<span class="keyword">typeof</span> exports !== <span class="string">'undefined'</span>) {
    exports.foo = foo;
  } <span class="keyword">else</span> {
    <span class="keyword">this</span>.foo = foo;
  }

  <span class="comment">// Browser style code goes here.</span>
}).call(<span class="keyword">this</span>);
</pre></td></tr></table></figure>

<p><code>this</code> is the same as <code>window</code> object in the browser environment.</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre>(<span class="function"><span class="keyword">function</span> <span class="params">(window)</span> {</span>
  <span class="comment">// Browser style code goes here.</span>
}(<span class="keyword">this</span>));
</pre></td></tr></table></figure>

<p>One more thing, writing in <a href="coffeescript.org">CoffeeScript</a> is even better, because the compiled<br>code is already wrapped in closure, fewer indentation is needed.</p>
<figure class="highlight lang-coffeescript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
</pre></td><td class="code"><pre>foo = {}
<span class="keyword">if</span> exports <span class="keyword">isnt</span> <span class="string">'undefined'</span>
  exports.foo = foo
<span class="keyword">else</span>
  <span class="keyword">this</span>.foo = foo

<span class="comment"># Browser style code goes here.</span>
</pre></td></tr></table></figure>

<p>Compile to JavaScript by <a href="coffeescript.org">CoffeeScript</a> 1.6.3:</p>
<figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="code"><pre>(<span class="keyword">function</span>() {
  <span class="keyword">var</span> foo;

  foo = {};

  <span class="keyword">if</span> (exports !== <span class="string">'undefined'</span>) {
    exports.foo = foo;
  } <span class="keyword">else</span> {
    <span class="keyword">this</span>.foo = foo;
  }

}).call(<span class="keyword">this</span>);
</pre></td></tr></table></figure>

<p>Everything will be encapsulated inside the <code>foo</code> object.</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


  
    <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2013-06-09T16:55:23.000Z"><a href="/2013/06/09/repeat-character-serveral-times-in-javascript/">Jun 9, 2013</a></time>
      
      
  
    <h1 class="title"><a href="/2013/06/09/repeat-character-serveral-times-in-javascript/">Repeat Character Serveral Times in JavaScript</a></h1>
  

    </header>
    <div class="entry">
      
        <p>In <a href="http://daringfireball.net/projects/markdown/">Markdown</a>, a header can be written as:</p>
<figure class="highlight lang-markdown"><table><tr><td class="gutter"><pre>1
2
</pre></td><td class="code"><pre><span class="header">Header
======</span>
</pre></td></tr></table></figure>

<p>This is a Setext-style headers, which are <em>‘underlined’ using equal signs (for<br>first-level headers) and dashes (for second-level headers)</em>. In order to<br>generate those underlined equal signs, a simple loop could be used to repeat<br>the character <code>=</code> several times. By the way, it is not necessary to have exact<br>number of the equal signs as the header length, but it just looks better. But<br>there is <a href="http://stackoverflow.com/a/1877479/594696">another way</a>:</p>
<figure class="highlight lang-JavaScript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>Array(heading.length + <span class="number">1</span>).join(<span class="string">'='</span>)
</pre></td></tr></table></figure>

<p>It is using the JavaScript <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array">Array</a> global object to construct an empty Array<br>with the specified array length. Clever indeed!</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


  

  <nav id="pagination">
  
  
  <div class="clearfix"></div>
</nav>
</div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="Search">
    <input type="hidden" name="q" value="site:realguess.net">
  </form>
</div>

  

  
<div class="widget tag">
  <h3 class="title">Tags</h3>
  <ul class="entry">
  
    <li><a href="/tags/2013/">2013</a><small>1</small></li>
  
    <li><a href="/tags/absolute-path/">absolute-path</a><small>1</small></li>
  
    <li><a href="/tags/amazon/">amazon</a><small>1</small></li>
  
    <li><a href="/tags/amtrak/">amtrak</a><small>1</small></li>
  
    <li><a href="/tags/android/">android</a><small>1</small></li>
  
    <li><a href="/tags/android-4.3/">android-4.3</a><small>1</small></li>
  
    <li><a href="/tags/anonymous-function/">anonymous-function</a><small>1</small></li>
  
    <li><a href="/tags/array/">array</a><small>2</small></li>
  
    <li><a href="/tags/automatic-link/">automatic-link</a><small>1</small></li>
  
    <li><a href="/tags/awk/">awk</a><small>1</small></li>
  
    <li><a href="/tags/aws/">aws</a><small>2</small></li>
  
    <li><a href="/tags/aws-cli/">aws-cli</a><small>1</small></li>
  
    <li><a href="/tags/best-practice/">best-practice</a><small>1</small></li>
  
    <li><a href="/tags/big-apple/">big-apple</a><small>1</small></li>
  
    <li><a href="/tags/big-easy/">big-easy</a><small>1</small></li>
  
    <li><a href="/tags/big-number/">big-number</a><small>1</small></li>
  
    <li><a href="/tags/browser/">browser</a><small>1</small></li>
  
    <li><a href="/tags/cat/">cat</a><small>1</small></li>
  
    <li><a href="/tags/chat/">chat</a><small>1</small></li>
  
    <li><a href="/tags/chrome/">chrome</a><small>1</small></li>
  
    <li><a href="/tags/cli/">cli</a><small>1</small></li>
  
    <li><a href="/tags/cloud-storage/">cloud-storage</a><small>1</small></li>
  
    <li><a href="/tags/cocoon/">cocoon</a><small>1</small></li>
  
    <li><a href="/tags/coding-style/">coding-style</a><small>1</small></li>
  
    <li><a href="/tags/coffeelint/">coffeelint</a><small>1</small></li>
  
    <li><a href="/tags/coffeescript/">coffeescript</a><small>7</small></li>
  
    <li><a href="/tags/command-history/">command-history</a><small>1</small></li>
  
    <li><a href="/tags/command-line/">command-line</a><small>1</small></li>
  
    <li><a href="/tags/command-line-interface/">command-line-interface</a><small>1</small></li>
  
    <li><a href="/tags/configuration/">configuration</a><small>1</small></li>
  
    <li><a href="/tags/crescent/">crescent</a><small>1</small></li>
  
    <li><a href="/tags/cron/">cron</a><small>2</small></li>
  
    <li><a href="/tags/crontab/">crontab</a><small>1</small></li>
  
    <li><a href="/tags/cryptography/">cryptography</a><small>1</small></li>
  
    <li><a href="/tags/custom-domain/">custom-domain</a><small>1</small></li>
  
    <li><a href="/tags/custom-generator/">custom-generator</a><small>1</small></li>
  
    <li><a href="/tags/cwd/">cwd</a><small>1</small></li>
  
    <li><a href="/tags/datagram/">datagram</a><small>1</small></li>
  
    <li><a href="/tags/date/">date</a><small>1</small></li>
  
    <li><a href="/tags/diff/">diff</a><small>1</small></li>
  
    <li><a href="/tags/distributed-team/">distributed-team</a><small>1</small></li>
  
    <li><a href="/tags/docco/">docco</a><small>1</small></li>
  
    <li><a href="/tags/echo/">echo</a><small>1</small></li>
  
    <li><a href="/tags/ecmascript-harmony/">ecmascript-harmony</a><small>1</small></li>
  
    <li><a href="/tags/encryption/">encryption</a><small>1</small></li>
  
    <li><a href="/tags/environment/">environment</a><small>2</small></li>
  
    <li><a href="/tags/environment-variable/">environment-variable</a><small>1</small></li>
  
    <li><a href="/tags/express/">express</a><small>1</small></li>
  
    <li><a href="/tags/file-system/">file-system</a><small>1</small></li>
  
    <li><a href="/tags/filename/">filename</a><small>1</small></li>
  
    <li><a href="/tags/fs/">fs</a><small>1</small></li>
  
    <li><a href="/tags/function/">function</a><small>3</small></li>
  
    <li><a href="/tags/function-declaration/">function-declaration</a><small>2</small></li>
  
    <li><a href="/tags/function-expression/">function-expression</a><small>3</small></li>
  
    <li><a href="/tags/function-innovation/">function-innovation</a><small>1</small></li>
  
    <li><a href="/tags/generator/">generator</a><small>1</small></li>
  
    <li><a href="/tags/get/">get</a><small>1</small></li>
  
    <li><a href="/tags/ghost/">ghost</a><small>1</small></li>
  
    <li><a href="/tags/github/">github</a><small>1</small></li>
  
    <li><a href="/tags/goal/">goal</a><small>1</small></li>
  
    <li><a href="/tags/google-keep/">google-keep</a><small>1</small></li>
  
    <li><a href="/tags/grunt/">grunt</a><small>1</small></li>
  
    <li><a href="/tags/grunt-contrib-jshint/">grunt-contrib-jshint</a><small>1</small></li>
  
    <li><a href="/tags/grunt-contrib-watch/">grunt-contrib-watch</a><small>1</small></li>
  
    <li><a href="/tags/guard/">guard</a><small>1</small></li>
  
    <li><a href="/tags/head/">head</a><small>2</small></li>
  
    <li><a href="/tags/hipchat/">hipchat</a><small>1</small></li>
  
    <li><a href="/tags/hong-kong/">hong-kong</a><small>1</small></li>
  
    <li><a href="/tags/hosted-zone/">hosted-zone</a><small>1</small></li>
  
    <li><a href="/tags/http/">http</a><small>1</small></li>
  
    <li><a href="/tags/id/">id</a><small>1</small></li>
  
    <li><a href="/tags/iife/">iife</a><small>2</small></li>
  
    <li><a href="/tags/immediately-invoked-function-expression/">immediately-invoked-function-expression</a><small>2</small></li>
  
    <li><a href="/tags/interpreter/">interpreter</a><small>1</small></li>
  
    <li><a href="/tags/javascript/">javascript</a><small>8</small></li>
  
    <li><a href="/tags/jelly-bean/">jelly-bean</a><small>1</small></li>
  
    <li><a href="/tags/join/">join</a><small>1</small></li>
  
    <li><a href="/tags/jshint/">jshint</a><small>1</small></li>
  
    <li><a href="/tags/json/">json</a><small>1</small></li>
  
    <li><a href="/tags/koa/">koa</a><small>1</small></li>
  
    <li><a href="/tags/line-divider/">line-divider</a><small>1</small></li>
  
    <li><a href="/tags/linux/">linux</a><small>3</small></li>
  
    <li><a href="/tags/livereload/">livereload</a><small>1</small></li>
  
    <li><a href="/tags/markdown/">markdown</a><small>2</small></li>
  
    <li><a href="/tags/mi3/">mi3</a><small>1</small></li>
  
    <li><a href="/tags/mongodb/">mongodb</a><small>1</small></li>
  
    <li><a href="/tags/mongoexport/">mongoexport</a><small>1</small></li>
  
    <li><a href="/tags/multi-parts/">multi-parts</a><small>1</small></li>
  
    <li><a href="/tags/named-function/">named-function</a><small>1</small></li>
  
    <li><a href="/tags/nb/">nb</a><small>1</small></li>
  
    <li><a href="/tags/network/">network</a><small>1</small></li>
  
    <li><a href="/tags/new-orleans/">new-orleans</a><small>1</small></li>
  
    <li><a href="/tags/new-york/">new-york</a><small>1</small></li>
  
    <li><a href="/tags/node/">node</a><small>8</small></li>
  
    <li><a href="/tags/nodemon/">nodemon</a><small>1</small></li>
  
    <li><a href="/tags/normalization/">normalization</a><small>1</small></li>
  
    <li><a href="/tags/nota-bene/">nota-bene</a><small>1</small></li>
  
    <li><a href="/tags/note-well/">note-well</a><small>1</small></li>
  
    <li><a href="/tags/npm/">npm</a><small>1</small></li>
  
    <li><a href="/tags/npm-module/">npm-module</a><small>1</small></li>
  
    <li><a href="/tags/null/">null</a><small>1</small></li>
  
    <li><a href="/tags/object/">object</a><small>1</small></li>
  
    <li><a href="/tags/parseint/">parseint</a><small>1</small></li>
  
    <li><a href="/tags/path/">path</a><small>3</small></li>
  
    <li><a href="/tags/ping/">ping</a><small>1</small></li>
  
    <li><a href="/tags/preinstall/">preinstall</a><small>1</small></li>
  
    <li><a href="/tags/process/">process</a><small>1</small></li>
  
    <li><a href="/tags/proxy/">proxy</a><small>1</small></li>
  
    <li><a href="/tags/query-parameter/">query-parameter</a><small>1</small></li>
  
    <li><a href="/tags/record-set/">record-set</a><small>1</small></li>
  
    <li><a href="/tags/relative-path/">relative-path</a><small>1</small></li>
  
    <li><a href="/tags/remote-working/">remote-working</a><small>1</small></li>
  
    <li><a href="/tags/repl/">repl</a><small>1</small></li>
  
    <li><a href="/tags/require/">require</a><small>1</small></li>
  
    <li><a href="/tags/rlwrap/">rlwrap</a><small>1</small></li>
  
    <li><a href="/tags/route-53/">route-53</a><small>1</small></li>
  
    <li><a href="/tags/scaffolding/">scaffolding</a><small>1</small></li>
  
    <li><a href="/tags/script/">script</a><small>1</small></li>
  
    <li><a href="/tags/settings/">settings</a><small>1</small></li>
  
    <li><a href="/tags/shabang/">shabang</a><small>1</small></li>
  
    <li><a href="/tags/sharing/">sharing</a><small>1</small></li>
  
    <li><a href="/tags/shebang/">shebang</a><small>1</small></li>
  
    <li><a href="/tags/shell/">shell</a><small>1</small></li>
  
    <li><a href="/tags/shell-script/">shell-script</a><small>1</small></li>
  
    <li><a href="/tags/source-maps/">source-maps</a><small>1</small></li>
  
    <li><a href="/tags/split/">split</a><small>1</small></li>
  
    <li><a href="/tags/sshuttle/">sshuttle</a><small>1</small></li>
  
    <li><a href="/tags/startup/">startup</a><small>1</small></li>
  
    <li><a href="/tags/stats/">stats</a><small>1</small></li>
  
    <li><a href="/tags/success/">success</a><small>1</small></li>
  
    <li><a href="/tags/sync/">sync</a><small>1</small></li>
  
    <li><a href="/tags/time-zone/">time-zone</a><small>1</small></li>
  
    <li><a href="/tags/todo/">todo</a><small>1</small></li>
  
    <li><a href="/tags/train/">train</a><small>1</small></li>
  
    <li><a href="/tags/travel/">travel</a><small>1</small></li>
  
    <li><a href="/tags/tumblr/">tumblr</a><small>1</small></li>
  
    <li><a href="/tags/twitter/">twitter</a><small>1</small></li>
  
    <li><a href="/tags/ubuntu/">ubuntu</a><small>1</small></li>
  
    <li><a href="/tags/uglifyjs/">uglifyjs</a><small>1</small></li>
  
    <li><a href="/tags/underscore/">underscore</a><small>1</small></li>
  
    <li><a href="/tags/unix/">unix</a><small>1</small></li>
  
    <li><a href="/tags/username/">username</a><small>1</small></li>
  
    <li><a href="/tags/vim/">vim</a><small>2</small></li>
  
    <li><a href="/tags/vimdiff/">vimdiff</a><small>1</small></li>
  
    <li><a href="/tags/vpn/">vpn</a><small>1</small></li>
  
    <li><a href="/tags/web-framework/">web-framework</a><small>1</small></li>
  
    <li><a href="/tags/xiaomi/">xiaomi</a><small>1</small></li>
  
    <li><a href="/tags/yeoman/">yeoman</a><small>1</small></li>
  
    <li><a href="/tags/yield/">yield</a><small>1</small></li>
  
    <li><a href="/tags/小米/">小米</a><small>1</small></li>
  
    <li><a href="/tags/小米手机/">小米手机</a><small>1</small></li>
  
  </ul>
</div>


  

</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2014 Chao Huang
  
</div>
<div class="clearfix"></div></footer>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

</body>
</html>